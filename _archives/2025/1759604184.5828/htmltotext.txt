 {"version":3,"file":"createPlatformWorker.inline.6a5db473.bundle.min.js","mappings":"2KAAA,MACCA,aACCC,YAAY,eAAEC,GAAgB,aAC9BC,EACAC,qBAAqB,SAAEC,GACvBC,MAAM,gBAAEC,IACR,iBACDC,GACGC,OAEEC,EAAwBC,QAAUR,EAAaS,SAAS,YAqDjDC,EAAwBH,EA9ChBI,WACpB,MAAMC,EAAW,iCACjBC,YAAYC,KAAKF,GAEjB,MAAM,gBAAEG,EAAe,YAAEC,EAAW,cAAEC,EAAa,gBAAEC,GAAoBhB,GACnE,aAAEiB,EAAY,qCAAEC,EAAoC,eAAEC,GAAmBJ,EACzEK,EACLP,EAAgBQ,WAAW,sBAAwBR,EAAgBQ,WAAW,iCAAmCC,SAASC,UAAYC,SAASC,KAZrH,CAACC,IAC5B,MAAMC,EAAO,IAAIC,KAAK,CAAC,kBAAkBF,QAAiB,CAAEG,KAAM,2BAClE,OAAOC,IAAIC,gBAAgBJ,IAWvBK,CAAoBnB,GACpBA,EAAgBoB,QAAQpC,EAAeqC,YAAa,GAAGhC,eAErDiC,EAAiB,IAAI7B,OAAOc,GAC5BgB,EAAoCC,OAAOC,KAAKxB,EAAYyB,MAChEC,OAAQC,IAAQxB,EAAawB,IAAKC,mBAClCC,OAAO,CAACC,EAA0CH,KAClDG,EAAgBH,GAAM3B,EAAYyB,KAAKE,GAChCG,GACL,CAAC,GAEL,GAAI5B,GAAmBA,EAAgB6B,UAAY7B,EAAgB8B,YAAa,CACpCT,OAAOU,OAAO7B,GAAsC8B,MAAOC,GAAMA,IAClE9B,EACzCgB,EAAee,YAAY,CAC1BrB,KAAM,oBACNsB,WAAYhD,IAGbgC,EAAee,YAAY,CAC1BrB,KAAM,uBACNb,mB,CAKHmB,EAAee,YAAY,CAC1BrB,KAAM,2BACNuB,eAAgBhB,IAGjB,MAAMiB,EAAU,+BAIhB,OAHA1C,YAAYC,KAAKyC,GACjB1C,YAAY2C,QAAQ,6BAA8B5C,EAAU2C,GAErDlB,GAGqDoB,GAAiBC,QAAQC,S","sources":["webpack:///../../thunderbolt-platform/src/client/create-worker.ts"],"sourcesContent":["const {\n\tviewerModel: {\n\t\tsiteAssets: { clientTopology },\n\t\tsiteFeatures,\n\t\tsiteFeaturesConfigs: { platform },\n\t\tsite: { externalBaseUrl },\n\t},\n\tusedPlatformApis,\n} = window\n\nconst shouldCreateWebWorker = Worker && siteFeatures.includes('platform')\n\nconst createWorkerBlobUrl = (workerUrl: string) => {\n\tconst blob = new Blob([`importScripts('${workerUrl}');`], { type: 'application/javascript' })\n\treturn URL.createObjectURL(blob)\n}\n\nconst createWorker = async () => {\n\tconst starMark = 'platform_create-worker started'\n\tperformance.mark(starMark)\n\n\tconst { clientWorkerUrl, appsScripts, bootstrapData, sdksStaticPaths } = platform\n\tconst { appsSpecData, appDefIdToIsMigratedToGetPlatformApi, forceEmptySdks } = bootstrapData\n\tconst url =\n\t\tclientWorkerUrl.startsWith('http://localhost:') || clientWorkerUrl.startsWith('https://bo.wix.com/suricate/') || document.baseURI !== location.href\n\t\t\t? createWorkerBlobUrl(clientWorkerUrl)\n\t\t\t: clientWorkerUrl.replace(clientTopology.fileRepoUrl, `${externalBaseUrl}/_partials`)\n\n\tconst platformWorker = new Worker(url)\n\tconst nonFederatedAppsOnPageScriptsUrls = Object.keys(appsScripts.urls)\n\t\t.filter((id) => !appsSpecData[id]?.isModuleFederated)\n\t\t.reduce((appsScriptsUrls: typeof appsScripts.urls, id) => {\n\t\t\tappsScriptsUrls[id] = appsScripts.urls[id]\n\t\t\treturn appsScriptsUrls\n\t\t}, {})\n\n\tif (sdksStaticPaths && sdksStaticPaths.mainSdks && sdksStaticPaths.nonMainSdks) {\n\t\tconst areAllAppsMigratedToGetPlatformApi = Object.values(appDefIdToIsMigratedToGetPlatformApi).every((x) => x)\n\t\tif (areAllAppsMigratedToGetPlatformApi || forceEmptySdks) {\n\t\t\tplatformWorker.postMessage({\n\t\t\t\ttype: 'preloadNamespaces',\n\t\t\t\tnamespaces: usedPlatformApis,\n\t\t\t})\n\t\t} else {\n\t\t\tplatformWorker.postMessage({\n\t\t\t\ttype: 'preloadAllNamespaces',\n\t\t\t\tsdksStaticPaths,\n\t\t\t})\n\t\t}\n\t}\n\n\tplatformWorker.postMessage({\n\t\ttype: 'platformScriptsToPreload',\n\t\tappScriptsUrls: nonFederatedAppsOnPageScriptsUrls,\n\t})\n\n\tconst endMark = 'platform_create-worker ended'\n\tperformance.mark(endMark)\n\tperformance.measure('Create Platform Web Worker', starMark, endMark)\n\n\treturn platformWorker\n}\n\nexport const platformWorkerPromise = shouldCreateWebWorker ? createWorker() : Promise.resolve()\n"],"names":["viewerModel","siteAssets","clientTopology","siteFeatures","siteFeaturesConfigs","platform","site","externalBaseUrl","usedPlatformApis","window","shouldCreateWebWorker","Worker","includes","platformWorkerPromise","async","starMark","performance","mark","clientWorkerUrl","appsScripts","bootstrapData","sdksStaticPaths","appsSpecData","appDefIdToIsMigratedToGetPlatformApi","forceEmptySdks","url","startsWith","document","baseURI","location","href","workerUrl","blob","Blob","type","URL","createObjectURL","createWorkerBlobUrl","replace","fileRepoUrl","platformWorker","nonFederatedAppsOnPageScriptsUrls","Object","keys","urls","filter","id","isModuleFederated","reduce","appsScriptsUrls","mainSdks","nonMainSdks","values","every","x","postMessage","namespaces","appScriptsUrls","endMark","measure","createWorker","Promise","resolve"],"sourceRoot":""}    